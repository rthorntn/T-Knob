<h1 align = "center">T-Knob fork</h1>

Going to try to demistify this product, I'm interested in removing the top circular "I/O" PCB and its "stalk" so I can use the motor and encoder as a smart knob with software detents and limits like https://github.com/scottbez1/smartknob

![alt text](image.png)
![alt text](pcb.jpeg)

Other data is placed in the `hardware` folder
|  Arduino IDE  |                                                          v2.2.1                                                          |
|:-------------:|:------------------------------------------------------------------------------------------------------------------------:|
|    Module     | [esp32-C6-MINI-1U](https://www.espressif.com/sites/default/files/documentation/esp32-c6-mini-1_mini-1u_datasheet_en.pdf) |
| MotorDriverIC |   [TMC6300](https://docs.sparkfun.com/SparkFun_IoT_Brushless_Motor_Driver/assets/component_documentation/TMC6300.pdf)    |
|  HallSensor   |                              [MT6701](https://www.magntek.com.cn/upload/MT6701_Rev.1.0.pdf)                              |

## :two: Module üéÅ

### 1„ÄÅFolder structure:
~~~
‚îú‚îÄ3D_File : 3D model file;
‚îú‚îÄexample : Some examples;
‚îú‚îÄfirmware : `factory` compiled firmware;
‚îú‚îÄhardware: Schematic diagram of the board, chip data;
~~~

### 2„ÄÅExamples

~~~
- ‚úÖ 1_simple_drive : Let the electric motor up, using 6-step commutation drive motor;
- ‚úÖ 2_encoder_mt6701 : Drive magnetic encoder, serial print read data;
- ‚úÖ 3_mcpwm_ctrl : mcpwm controller drives the motor;
- ‚úÖ 4_mcpwm_mt6701 : mcpwm controller is used to drive the motor and read the encoder data at the same time.
- ‚úÖ 5_foc_openloop_velocity : foc open-loop speed control is used to drive the motor.
- ‚úÖ 6_foc_openloop_angle : foc Angle control drive motor;
- ‚úÖ 7_foc_closeloop_pos_and_speed : foc Angle control drive motor;
- ‚úÖ 8_pid_and_lowpadd_filter : On the basis of 7, add pid control and low-pass filtering;
- ‚úÖ T-MotorDriver-C6-firmware : The firmware generated by 8 compilation is used as a factory program;
~~~

## :three: Quick Start üéÅ

1. Install [Arduino IDE](https://www.arduino.cc/en/software)
2. Install the esp32 toolkit, open the Arduino IDE, click on `File->Preferences`, Then `https://espressif.github.io/arduino-esp32/package_esp32_dev_index.json` paste to the position of the diagram below, then click :ok:, waiting for the toolkit download is complete;

![](./hardware/image.png)

3. Open a example using the Arduino IDE, and configure the Arduino as follows.Notice where the yellow boxes are.

:exclamation: :exclamation: **Note: If the `board` cannot find the ESP32C6, perform the `step 2`.** :exclamation: :exclamation:

![](./hardware/image_config.png)

4. Finally click update :arrow_right: to download the program.


## :four: Pins üéÅ

~~~c
// MT6071
#define MAG_CS  7
#define MAG_CLK 14
#define MAG_DIO 15

// MTC6300
#define BLDC_DRV_FAULT_GPIO 2
#define UH_PIN 6
#define UL_PIN 5
#define VH_PIN 1
#define VL_PIN 3
#define WH_PIN 0
#define WL_PIN 4

// BOOT & LED
#define BTN_RELEASE_STATE 1  // HIGH is release state
#define BOARD_BOOT 9
#define BOARD_LED1 23
#define BOARD_LED2 22
#define BOARD_LED3 21
#define BOARD_LED4 20
#define BOARD_BUZZ 18
~~~

For more information, see the `./hardware` directory.

Schematic : [T-Embed-CC1101](./hardware/T-Embed-CC1101%20V1.0%2024-07-29.pdf)

CC1101 Schematic : [CC1101](./hardware/cc1101-shield.pdf)

CC1101 Pins : [CC1101 Pins](./hardware/CC1101_pin.png)
